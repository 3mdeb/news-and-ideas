---
title: Dasharo compatible with MSI PRO Z690-A release v1.1.1
abstract: 'A short overview of changes introduced in v1.1.1
           release of Dasharo compatible with MSI PRO Z690-A
	   with a short demo of Qubes OS 4.1.2.'
cover: /covers/image-file.png
author: michal.zygowski
layout: post
published: true
date: 2023-02-24
archives: "2023"

tags:
  - firmware
  - coreboot
  - Dasharo
categories:
  - Firmware


---

# Introduction

New year and new exciting news. Dasharo Team has just released a new version of
Dasharo firmware compatible with MSI PRO Z690-A. Last v1.1.0 version was
released on 22th of November 2022 and after 3 months the time has come for v1.1.1.
Let's see what's new.

# Key changes in new release

The past 3 months were mostly spent on debugging and resolving issues reported
by community on Matrix and
[GitHub](https://github.com/Dasharo/dasharo-issues/issues/new/choose). By the
way, if you haven't joined our [Matrix Dasharo space](https://matrix.to/#/#dasharo:matrix.org)
yet, do it quick! That is where all interesting stuff happens, like
various technical discussions, hardware setups, firmware configurations and
encountered issues.

Let's have a look at the changelog.

### Added

- [Early boot DMA protection menu option](https://github.com/Dasharo/dasharo-issues/issues/275)

  Many people reported various issues when DMA protection was introduced in
  v1.1.0. Apparently certain GPU cards contain broken OptionROMs which cause
  DMA errors and display initialization problems. Thus the firmware setup will
  now contain an option to enable/disable the DMA protection on-demand (with
  default state being disabled to avoid problems with dGPUs). Additionally an
  option to keep IOMMU enabled during OS control hand-off (actually during the
  UEFI Exit Boot Services) has been added. This setting may be especially
  interesting for people seeking for the most secure configuration of the
  firmware. But keep in mind, your Windows will not boot if you enable this
  option! Refer to our [firmware setup documentation](https://docs.dasharo.com/dasharo-menu-docs/dasharo-system-features/#dasharo-security-options)
  for more details.

- ACPI PCI interrupt routing for CPU PCIe Root Ports

  The CPU PCI Express root ports had no interrupt routing information reported
  in ACPI. Just a small fix.

- OC Watchdog ACPI device as in MSI firmware

  Original MSI firmware has been reporting an ACPI device describing the
  overclocking watchdog. This watchdog is being used by overclocking platforms
  since 6th generation of Intel Core processors. The same ACPI device has been
  added to Dasharo to keep consistency. Possibly Windows overclocking tools may
  depend on it.

### Changed

- Updated SMMSTORE driver to upstream version in UEFI Payload

  An update to the driver serving as a backend to write variables to the SPI
  flash from UEFI Payload. The change was introduced due to problems with
  variable updates on other Dasharo platform. The advantage of the update is a
  cleaned up code with better quality.

- [Improved visual comfort in the boot manager](https://github.com/Dasharo/dasharo-issues/issues/286)

  Minor visual improvement reported by one of laptop users unable to
  distinguish the entries in the Boot Manager boot device selection window. Now
  the currently selected device is indicated by an arrow and highlighted with
  blue color.

### Fixed

- [MSI PRO Z690-A WIFI DDR4 doesn't initialize IGP on certain Processors models](https://github.com/Dasharo/dasharo-issues/issues/274)

  This fix is a crucial one in this release. Many users reported non-working
  on-board displays with different CPUs than those which were tested in 3mdeb
  lab. Now all Alder Lake-S graphics devices should be initialized properly and
  give firmware output on the screen.

- [MSI PRO Z690-A WIFI DDR4 with two Video Cards (2x Radeon 5600XT) has issues related to MMIO resource allocation](https://github.com/Dasharo/dasharo-issues/issues/245)

  Quite specific issue with board configuration overloaded with GPU cards in
  the community. As such configuration is not common, the debugging involved
  the issue reporter cooperation by flashing custom binaries and providing
  debug logs from Dasharo firmware. It happened that the memory requested by
  both of the cards was too big to fit into the 32 bit space. The fix for this
  one required reserving much more space for devices' memory in the 32 bit
  space, by shifting some of the usable RAM in 32 bit space to 64 bit space.
  Such change let the firmware allocate all memory resources required by both
  GPUs.

- [Suspend doesn't work in Qubes OS with v1.1.0](https://github.com/Dasharo/dasharo-issues/issues/271)

  Another issue discovered by community. One of Dasharo Team changes introduced
  an regression in the suspend/resume feature. All OSes were affected. Fix has
  been applied and the suspend/resume should now work on all OSes. The tests
  have been also extended with multiple suspend/resume cycles to avoid such
  problem in the future.

- [Intel XTU on Windows reports "The platform does not support overclocking" on the MSI PRO Z690-A WIFI DDR4 with a K-series Processor](https://github.com/Dasharo/dasharo-issues/issues/159)

  The issue has been reported by community in the first days after v1.0.0
  release. Surprisingly the Intel XTU utility reported that platform does not
  support overclocking, despite all components had all the overclocking
  capabilities. The culprit was the OC lock bit being set by default in FSP
  which prevented Intel XTU from modifying any settings from Windows level, so
  it reported the platform as unsupported. The OC lock changes the
  initialization path inside FSP, so you may encounter some unexpected changes
  in CPU configuration. Please do not hesitate to report them. One of such
  unexpected changes was an override of CPU turbo limits and causing the CPU
  frequency to be lower than maximum default value (and so the performance was
  degraded).

- [SATA ports malfunction or Hot-Plug function disabled](https://github.com/Dasharo/dasharo-issues/issues/315)

  A feature request from community to enable SATA hotplug functionality.

- Platform sometimes automatically powers on after power off

  Noticed by one of Dasharo Team developers when dGPUs are plugged. It happened
  that the dGPUs were sending ACPi SCI interrupts which are not currently
  handled by ACPI code and it resulted in instant wake up of the board when
  powering off. The SCI interrupts have been disabled on all PCI Express Root
  Ports, until proper handling of SCI is implemented to fix the problem.

- GPIO controller ACPI device yellow bang in Windows device manager

  Despite previous attempts to fix the yellow bang of GPIO controller in
  Windows Device Manager, the issue still persisted. The ACPI GPIO controller
  device had all the definitions of GPIOs for Alder Lake-S, but apparently,
  Windows was unable to properly initialize the GPIO because of the silent
  dependency on the ACPI path of the device in the Windows GPIO driver. While
  Linux had no problems with previous ACPI path, Windows could not properly
  load drivers in correct sequence, thus the ACPI path had to be changed from
  `\_SB.PCI0.GPIO` to `\_SB.GPIO` so that Windows will not depend on
  enumeration and initialization of `\_SB.PCI0` ACPI device. Similar issues
  were observed with TPM2 device ACPI path. When set wrong, the Windows 11
  installer would not work. Now the yellow bang in Device Manager should be
  gone for good.

- Resource conflicts with chipset internal P2SB PCI device being incorrectly
  defined and initialized in coreboot

  Issue observed during the 2x dGPU memory allocation problems and GPIO
  allocation problems. It occurred that coreboto did not reserve proper memory
  range for one of the chipset internal PCI devices resulting in resource
  conflicts and issues with overall operation of conflicting devices. The issue
  could be detected earlier if not the FSP which hides this internal device
  during silicon initialization phase. Hidden device could not be detected by
  coreboot resource allocator and thus the reserved memory for this device was
  not accounted for.

- Reset button hanging the platform for up to 2 minutes due to watchdog bug

  Noticed by Dasharo Team developer and also reported by Qubes OS community.
  Not exactly a regression, but a bug in the OC watchdog hardware which did not
  allow setting a small timeout to expire the watchdog after an unexpected
  reset (a reset button press for example). Initially the OC watchdog was
  designed to detect unstable overclocking configurations, when such board
  unexpectedly reset, the BIOS was supposed to detect it and act per policy to
  restore safe configuration. Dasharo intended to use it in the same way but
  the timeout not updating bug in the watchdog hardware caused the firmware to
  wait whole 2 minutes for watchdog expiration after reset button press. Now
  Dasharo firmware does not detect unexpected resets and simply initializes the
  watchdog by programming the timeout. Expiration is not handled in any way.

# Current state of Qubes OS R4.1.2 on MSI PRO Z690-A with Dasharo firmware

Here is a short demo of Qubes OS R4.1.2-rc1 running on the newest Dasharo
v1.1.1 compatible with MSI PRO Z690-A.

TBD: YT link?

## Summary

Dasharo v1.1.1 is definitely not the last release for the MSI PRO Z690-A
platform. If you would like to track what is planned for the next release,
please visit Dasharo GitHub. We are going to create an open project with
milestones indicating the scope of new features and fixes for given release. An
example project in such fashion has already been prepared for Supermicro X11SSH
board, which you can check out [here](https://github.com/Dasharo/dasharo-issues/projects/6). 

Unlock the full potential of your hardware and secure your firmware with
the experts at 3mdeb! If you're looking to boost your product's performance
and protect it from potential security threats, our team is here to help.
[Schedule a call with us](https://calendly.com/3mdeb/consulting-remote-meeting)
or drop us an email at `contact<at>3mdeb<dot>com` to start unlocking the
hidden benefits of your hardware. And if you want to stay up-to-date on all
things firmware security and optimization, be sure to
[sign up for our newsletter](https://newsletter.3mdeb.com/subscription/PW6XnCeK6).
Don't let your hardware hold you back, work with 3mdeb to achieve more!
