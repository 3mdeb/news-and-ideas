<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="650px" preserveAspectRatio="none" style="width:874px;height:650px;background:#FFFFFF;" version="1.1" viewBox="0 0 874 650" width="874px" zoomAndPan="magnify"><defs><filter height="300%" id="fauzu2a9mv8p" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="30" x2="30" y1="40.2969" y2="607.4219"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="423.5" x2="423.5" y1="40.2969" y2="607.4219"/><rect fill="#FEFECE" filter="url(#fauzu2a9mv8p)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="47" x="5" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="33" x="12" y="24.9951">Host</text><rect fill="#FEFECE" filter="url(#fauzu2a9mv8p)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="47" x="5" y="606.4219"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="33" x="12" y="626.417">Host</text><rect fill="#FEFECE" filter="url(#fauzu2a9mv8p)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="62" x="390.5" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="48" x="397.5" y="24.9951">Target</text><rect fill="#FEFECE" filter="url(#fauzu2a9mv8p)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="62" x="390.5" y="606.4219"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="48" x="397.5" y="626.417">Target</text><line style="stroke:#A80036;stroke-width:1.0;" x1="30.5" x2="72.5" y1="71.4297" y2="71.4297"/><line style="stroke:#A80036;stroke-width:1.0;" x1="72.5" x2="72.5" y1="71.4297" y2="84.4297"/><line style="stroke:#A80036;stroke-width:1.0;" x1="31.5" x2="72.5" y1="84.4297" y2="84.4297"/><polygon fill="#A80036" points="41.5,80.4297,31.5,84.4297,41.5,88.4297,37.5,84.4297" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="141" x="37.5" y="66.3638">Generate RSA keypair</text><line style="stroke:#A80036;stroke-width:1.0;" x1="30.5" x2="72.5" y1="113.5625" y2="113.5625"/><line style="stroke:#A80036;stroke-width:1.0;" x1="72.5" x2="72.5" y1="113.5625" y2="126.5625"/><line style="stroke:#A80036;stroke-width:1.0;" x1="31.5" x2="72.5" y1="126.5625" y2="126.5625"/><polygon fill="#A80036" points="41.5,122.5625,31.5,126.5625,41.5,130.5625,37.5,126.5625" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="306" x="37.5" y="108.4966">Sign RockChip loader binary with generated key</text><polygon fill="#A80036" points="411.5,151.6953,421.5,155.6953,411.5,159.6953,415.5,155.6953" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="30.5" x2="417.5" y1="155.6953" y2="155.6953"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="235" x="37.5" y="150.6294">Send signed binary using eFUSE Tool</text><line style="stroke:#A80036;stroke-width:1.0;" x1="423.5" x2="465.5" y1="184.8281" y2="184.8281"/><line style="stroke:#A80036;stroke-width:1.0;" x1="465.5" x2="465.5" y1="184.8281" y2="197.8281"/><line style="stroke:#A80036;stroke-width:1.0;" x1="424.5" x2="465.5" y1="197.8281" y2="197.8281"/><polygon fill="#A80036" points="434.5,193.8281,424.5,197.8281,434.5,201.8281,430.5,197.8281" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="437" x="430.5" y="179.7622">Extract public key, store key hash in eFUSE and enable Secure Mode</text><polygon fill="#A80036" points="41.5,222.9609,31.5,226.9609,41.5,230.9609,37.5,226.9609" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="35.5" x2="422.5" y1="226.9609" y2="226.9609"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="76" x="47.5" y="221.895">Send status</text><line style="stroke:#A80036;stroke-width:1.0;" x1="30.5" x2="72.5" y1="256.0938" y2="256.0938"/><line style="stroke:#A80036;stroke-width:1.0;" x1="72.5" x2="72.5" y1="256.0938" y2="269.0938"/><line style="stroke:#A80036;stroke-width:1.0;" x1="31.5" x2="72.5" y1="269.0938" y2="269.0938"/><polygon fill="#A80036" points="41.5,265.0938,31.5,269.0938,41.5,273.0938,37.5,269.0938" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="305" x="37.5" y="251.0278">Prepare firmware image with a signed TPL+SPL</text><polygon fill="#A80036" points="411.5,294.2266,421.5,298.2266,411.5,302.2266,415.5,298.2266" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="30.5" x2="417.5" y1="298.2266" y2="298.2266"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="369" x="37.5" y="293.1606">Send previously signed RockChip, but using rkdeveloptool</text><line style="stroke:#A80036;stroke-width:1.0;" x1="423.5" x2="465.5" y1="327.3594" y2="327.3594"/><line style="stroke:#A80036;stroke-width:1.0;" x1="465.5" x2="465.5" y1="327.3594" y2="340.3594"/><line style="stroke:#A80036;stroke-width:1.0;" x1="424.5" x2="465.5" y1="340.3594" y2="340.3594"/><polygon fill="#A80036" points="434.5,336.3594,424.5,340.3594,434.5,344.3594,430.5,340.3594" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="264" x="430.5" y="322.2935">Verify binary against key stored in eFUSE</text><line style="stroke:#A80036;stroke-width:1.0;" x1="423.5" x2="465.5" y1="369.4922" y2="369.4922"/><line style="stroke:#A80036;stroke-width:1.0;" x1="465.5" x2="465.5" y1="369.4922" y2="382.4922"/><line style="stroke:#A80036;stroke-width:1.0;" x1="424.5" x2="465.5" y1="382.4922" y2="382.4922"/><polygon fill="#A80036" points="434.5,378.4922,424.5,382.4922,434.5,386.4922,430.5,382.4922" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="436" x="430.5" y="364.4263">Execute DDR init binary, unlock MaskROM to allow firmware flashing</text><polygon fill="#A80036" points="41.5,407.625,31.5,411.625,41.5,415.625,37.5,411.625" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="35.5" x2="422.5" y1="411.625" y2="411.625"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="76" x="47.5" y="406.5591">Send status</text><polygon fill="#A80036" points="411.5,436.7578,421.5,440.7578,411.5,444.7578,415.5,440.7578" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="30.5" x2="417.5" y1="440.7578" y2="440.7578"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="94" x="37.5" y="435.6919">Send firmware</text><line style="stroke:#A80036;stroke-width:1.0;" x1="423.5" x2="465.5" y1="469.8906" y2="469.8906"/><line style="stroke:#A80036;stroke-width:1.0;" x1="465.5" x2="465.5" y1="469.8906" y2="482.8906"/><line style="stroke:#A80036;stroke-width:1.0;" x1="424.5" x2="465.5" y1="482.8906" y2="482.8906"/><polygon fill="#A80036" points="434.5,478.8906,424.5,482.8906,434.5,486.8906,430.5,482.8906" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="154" x="430.5" y="464.8247">Flash received firmware</text><polygon fill="#A80036" points="41.5,508.0234,31.5,512.0234,41.5,516.0234,37.5,512.0234" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="35.5" x2="422.5" y1="512.0234" y2="512.0234"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="76" x="47.5" y="506.9575">Send status</text><polygon fill="#A80036" points="411.5,537.1563,421.5,541.1563,411.5,545.1563,415.5,541.1563" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="30.5" x2="417.5" y1="541.1563" y2="541.1563"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="148" x="37.5" y="536.0903">Issue reboot command</text><rect fill="#FBFB77" filter="url(#fauzu2a9mv8p)" height="38" style="stroke:#A80036;stroke-width:1.0;" width="401" x="223" y="554.1563"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="393" x="227" y="570.2231">If the key got fused properly and firmware is properly signed,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="125" x="227" y="585.356">device should boot.</text><!--MD5=[601f7d4a7d9c814f8acba41bce54bab4]
@startuml
Host -> Host : Generate RSA keypair
Host -> Host : Sign RockChip loader binary with generated key
Host -> Target : Send signed binary using eFUSE Tool
Target -> Target : Extract public key, store key hash in eFUSE and enable Secure Mode
Host <- - Target : Send status
Host -> Host : Prepare firmware image with a signed TPL+SPL
Host -> Target : Send previously signed RockChip, but using rkdeveloptool
Target -> Target : Verify binary against key stored in eFUSE
Target -> Target : Execute DDR init binary, unlock MaskROM to allow firmware flashing
Host <- - Target : Send status
Host -> Target : Send firmware
Target -> Target : Flash received firmware
Host <- - Target : Send status
Host -> Target : Issue reboot command
rnote over Target
  If the key got fused properly and firmware is properly signed,
  device should boot.
endrnote
@enduml

PlantUML version 1.2021.14beta4(Unknown compile time)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>