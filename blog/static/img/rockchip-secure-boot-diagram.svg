<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="645px" preserveAspectRatio="none" style="width:967px;height:645px;" version="1.1" viewBox="0 0 967 645" width="967px" zoomAndPan="magnify"><defs><filter height="300%" id="f24osd9grzeq7" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="33" x2="33" y1="38.2969" y2="605.4219"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="509.5" x2="509.5" y1="38.2969" y2="605.4219"/><rect fill="#FEFECE" filter="url(#f24osd9grzeq7)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="46" x="8" y="3"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="32" x="15" y="22.9951">Host</text><rect fill="#FEFECE" filter="url(#f24osd9grzeq7)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="46" x="8" y="604.4219"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="32" x="15" y="624.417">Host</text><rect fill="#FEFECE" filter="url(#f24osd9grzeq7)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="59" x="478.5" y="3"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="45" x="485.5" y="22.9951">Target</text><rect fill="#FEFECE" filter="url(#f24osd9grzeq7)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="59" x="478.5" y="604.4219"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="45" x="485.5" y="624.417">Target</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="33" x2="75" y1="69.4297" y2="69.4297"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="75" x2="75" y1="69.4297" y2="82.4297"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="34" x2="75" y1="82.4297" y2="82.4297"/><polygon fill="#A80036" points="44,78.4297,34,82.4297,44,86.4297,40,82.4297" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="140" x="40" y="64.3638">Generate RSA keypair</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="33" x2="75" y1="111.5625" y2="111.5625"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="75" x2="75" y1="111.5625" y2="124.5625"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="34" x2="75" y1="124.5625" y2="124.5625"/><polygon fill="#A80036" points="44,120.5625,34,124.5625,44,128.5625,40,124.5625" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="302" x="40" y="106.4966">Sign RockChip loader binary with generated key</text><polygon fill="#A80036" points="498,149.6953,508,153.6953,498,157.6953,502,153.6953" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="33" x2="504" y1="153.6953" y2="153.6953"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="236" x="40" y="148.6294">Send signed binary using eFUSE Tool</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="510" x2="552" y1="182.8281" y2="182.8281"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="552" x2="552" y1="182.8281" y2="195.8281"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="511" x2="552" y1="195.8281" y2="195.8281"/><polygon fill="#A80036" points="521,191.8281,511,195.8281,521,199.8281,517,195.8281" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="438" x="517" y="177.7622">Extract public key, store key hash in eFUSE and enable Secure Mode</text><polygon fill="#A80036" points="44,220.9609,34,224.9609,44,228.9609,40,224.9609" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="38" x2="509" y1="224.9609" y2="224.9609"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="77" x="50" y="219.895">Send status</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="33" x2="75" y1="254.0938" y2="254.0938"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="75" x2="75" y1="254.0938" y2="267.0938"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="34" x2="75" y1="267.0938" y2="267.0938"/><polygon fill="#A80036" points="44,263.0938,34,267.0938,44,271.0938,40,267.0938" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="301" x="40" y="249.0278">Prepare firmware image with a signed TPL+SPL</text><polygon fill="#A80036" points="498,292.2266,508,296.2266,498,300.2266,502,296.2266" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="33" x2="504" y1="296.2266" y2="296.2266"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="453" x="40" y="291.1606">Send previously signed RockChip loader binary, but using rkdeveloptool</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="510" x2="552" y1="325.3594" y2="325.3594"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="552" x2="552" y1="325.3594" y2="338.3594"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="511" x2="552" y1="338.3594" y2="338.3594"/><polygon fill="#A80036" points="521,334.3594,511,338.3594,521,342.3594,517,338.3594" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="262" x="517" y="320.2935">Verify binary against key stored in eFUSE</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="510" x2="552" y1="367.4922" y2="367.4922"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="552" x2="552" y1="367.4922" y2="380.4922"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="511" x2="552" y1="380.4922" y2="380.4922"/><polygon fill="#A80036" points="521,376.4922,511,380.4922,521,384.4922,517,380.4922" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="428" x="517" y="362.4263">Execute DDR init binary, unlock MaskROM to allow firmware flashing</text><polygon fill="#A80036" points="44,405.625,34,409.625,44,413.625,40,409.625" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="38" x2="509" y1="409.625" y2="409.625"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="77" x="50" y="404.5591">Send status</text><polygon fill="#A80036" points="498,434.7578,508,438.7578,498,442.7578,502,438.7578" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="33" x2="504" y1="438.7578" y2="438.7578"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="92" x="40" y="433.6919">Send firmware</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="510" x2="552" y1="467.8906" y2="467.8906"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="552" x2="552" y1="467.8906" y2="480.8906"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="511" x2="552" y1="480.8906" y2="480.8906"/><polygon fill="#A80036" points="521,476.8906,511,480.8906,521,484.8906,517,480.8906" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="150" x="517" y="462.8247">Flash received firmware</text><polygon fill="#A80036" points="44,506.0234,34,510.0234,44,514.0234,40,510.0234" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="38" x2="509" y1="510.0234" y2="510.0234"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="77" x="50" y="504.9575">Send status</text><polygon fill="#A80036" points="498,535.1563,508,539.1563,498,543.1563,502,539.1563" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="33" x2="504" y1="539.1563" y2="539.1563"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="148" x="40" y="534.0903">Issue reboot command</text><rect fill="#FBFB77" filter="url(#f24osd9grzeq7)" height="38" style="stroke: #A80036; stroke-width: 1.0;" width="393" x="313" y="552.1563"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="385" x="317" y="568.2231">If the key got fused properly and firmware is properly signed,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="233" x="317" y="583.356">device should boot flashed firmware.</text><!--
@startuml
Host -> Host : Generate RSA keypair
Host -> Host : Sign RockChip loader binary with generated key
Host -> Target : Send signed binary using eFUSE Tool
Target -> Target : Extract public key, store key hash in eFUSE and enable Secure Mode
Host <- - Target : Send status
Host -> Host : Prepare firmware image with a signed TPL+SPL
Host -> Target : Send previously signed RockChip loader binary, but using rkdeveloptool
Target -> Target : Verify binary against key stored in eFUSE
Target -> Target : Execute DDR init binary, unlock MaskROM to allow firmware flashing
Host <- - Target : Send status
Host -> Target : Send firmware
Target -> Target : Flash received firmware
Host <- - Target : Send status
Host -> Target : Issue reboot command
rnote over Target
  If the key got fused properly and firmware is properly signed,
  device should boot flashed firmware.
endrnote
@enduml

PlantUML version 1.2018.13(Mon Nov 26 18:11:51 CET 2018)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 11.0.11+9-Ubuntu-0ubuntu2.20.04
Operating System: Linux
OS Version: 5.11.0-41-generic
Default Encoding: UTF-8
Language: pl
Country: PL
--></g></svg>